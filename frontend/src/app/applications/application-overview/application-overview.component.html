<div class="application-wrapper">
  <div class="header-with-button" xmlns="http://www.w3.org/1999/html">
    <h1>All applications</h1>
    <button (click)="addApplication()">Add New</button>
  </div>
  <div class="table-container ">
    <table mat-table [dataSource]="dataSource" class="mat-table full-width-table" matSort>
      <!-- Header and Row Declarations -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      <!-- Company -->
      <ng-container matColumnDef="company">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <div>
            <div>Company</div>
            <mat-form-field appearance="outline">
              <input matInput
                     (input)="applyColumnFilter('company', $event.target.value)"
                     placeholder="Filter" />
            </mat-form-field>
          </div>
        </th>
        <td mat-cell *matCellDef="let e"> {{ e.company }} </td>
      </ng-container>

      <!-- Job Title -->
      <ng-container matColumnDef="job_title">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <div>
            <div>Job Title</div>
            <mat-form-field appearance="outline">
              <input matInput
                     (input)="applyColumnFilter('job_title', $event.target.value)"
                     placeholder="Filter" />
            </mat-form-field>
          </div>
        </th>
        <td mat-cell *matCellDef="let e"> {{ e.job_title }} </td>
      </ng-container>

      <!-- Job Posting -->
      <ng-container matColumnDef="job_posting">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <div>
            <div>Job Posting</div>
            <mat-form-field appearance="outline">
              <input matInput
                     (input)="applyColumnFilter('job_posting', $event.target.value)"
                     placeholder="Filter" />
            </mat-form-field>
          </div>
        </th>
        <td mat-cell *matCellDef="let e"> {{ e.job_posting }} </td>
      </ng-container>

      <!-- Status -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <div>
            <div>Status</div>
            <mat-form-field appearance="outline">
              <mat-select
                      placeholder="Filter"
                      (selectionChange)="applyColumnFilter('status', $event.value)">
                <mat-option value="">All</mat-option>
                @for (status of statusValues; track status) {
                  <mat-option [value]="status">
                    {{ statusLabels[status] }}
                  </mat-option>
                }
              </mat-select>
            </mat-form-field>
          </div>
        </th>
        <td mat-cell *matCellDef="let e">
          <mat-form-field appearance="outline">
            <mat-select [value]="e.status" (selectionChange)="updateStatus(e, $event.value)">
              @for (status of statusValues; track status) {
                <mat-option [value]="status">
                  {{ statusLabels[status] }}
                </mat-option>
              }
            </mat-select>
          </mat-form-field>
        </td>
      </ng-container>

      <!-- Max Stage -->
      <ng-container matColumnDef="max_stage">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <div>
            <div> Max Stage </div>
            <mat-form-field appearance="outline" class="header-filter header-spacer" aria-hidden="true">
              <input matInput placeholder="Filter" />
            </mat-form-field>
          </div>
        </th>
        <td mat-cell *matCellDef="let e">
          <span>
            @if (e.max_stage === 'none') {
              <button mat-raised-button mat-button (click)="onStageChange(e, 'acknowledgment')">
                Received Acknowledgment
              </button>
            } @else {
              {{ getStageLabel(e.max_stage) }}
            }
          </span>
        </td>
      </ng-container>

      <!-- Application Date -->
      <ng-container matColumnDef="application_date">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <div>
            <div> Application Date </div>
            <mat-form-field appearance="outline" class="header-filter header-spacer" aria-hidden="true">
              <input matInput placeholder="Filter" />
            </mat-form-field>
          </div>
        </th>
        <td mat-cell *matCellDef="let e"> {{ e.application_date }} </td>
      </ng-container>

      <!-- Last Update -->
      <ng-container matColumnDef="last_update">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <div>
            <div> Last Update </div>
            <mat-form-field appearance="outline" class="header-filter header-spacer" aria-hidden="true">
              <input matInput placeholder="Filter" />
            </mat-form-field>
          </div>
        </th>
        <td mat-cell *matCellDef="let e"> {{ e.last_update }} </td>
      </ng-container>
    </table>
  </div>
</div>
